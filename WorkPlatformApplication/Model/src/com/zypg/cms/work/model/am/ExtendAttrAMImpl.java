package com.zypg.cms.work.model.am;

import com.honythink.applicationframework.hadf.CustomApplicationModuleImpl;


import com.zypg.cms.work.model.viewobject.common.CmsDocTVOImpl;
import com.zypg.cms.work.model.viewobject.common.CmsDocTVORowImpl;
import com.zypg.cms.work.model.viewobject.extendattr.CmsExtendAttrStorageTVOImpl;
import com.zypg.cms.work.model.viewobject.extendattr.CmsExtendAttrStorageTVORowImpl;
import com.zypg.cms.work.model.viewobject.extendattr.CmsExtendAttrVOImpl;

import com.zypg.cms.work.model.viewobject.extendattr.CmsExtendValueListImpl;

import java.util.HashMap;
import java.util.Map;

import oracle.jbo.domain.Number;
import oracle.jbo.Row;
import oracle.jbo.domain.ClobDomain;
import oracle.jbo.server.ApplicationModuleImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Mon May 18 15:06:49 CST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class ExtendAttrAMImpl extends CustomApplicationModuleImpl {
    /**
     * This is the default constructor (do not remove).
     */
    public ExtendAttrAMImpl() {
    }

    /**
     * 初始化自定义扩展字段
     * @param compCode
     * @param libCode
     */
    public void initExtendAttr(String compCode, String libCode) {
        CmsExtendAttrVOImpl vo = this.getCmsExtendAttrVO();
        vo.setbvCompCode(compCode);
        vo.setbvLibCode(libCode);
        vo.executeQuery();
        vo.setRangeSize(-1);
    }

    /**
     * 获取下拉列表字段
     * @param compCode
     * @param libCode
     * @return
     */
    public Row[] getExtendAttr4Choice(String compCode, String libCode) {
        CmsExtendAttrVOImpl vo = this.getCmsExtendAttrVO4Choice();
        vo.setbvCompCode(compCode);
        vo.setbvLibCode(libCode);
        vo.executeQuery();
        vo.setRangeSize(-1);
        return vo.getAllRowsInRange();
    }

    /**
     * 获取下拉列表中的值列表
     * @param extendAttrId
     * @return
     */
    public Row[] getExtendValueList(Number extendAttrId) {
        CmsExtendValueListImpl vo = this.getCmsExtendValueList4Choice();
        vo.setbvExtendAttrId(extendAttrId);
        vo.executeQuery();
        vo.setRangeSize(-1);
        return vo.getAllRowsInRange();
    }

    /**
     * 保存自定义扩展字段的值
     * @param actionName
     * @param docId
     * @param jsonStr
     */
    public void saveExtendAttrs(String actionName, Number docId, String jsonStr) {
        System.out.println("saveExtendAttrs-->actionName:" + actionName + "  docId:" + docId + "  jsonStr:" + jsonStr);
        CmsExtendAttrStorageTVOImpl vo = this.getCmsExtendAttrStorageTVO();
        if ("CREATE".equals(actionName)) {
            CmsExtendAttrStorageTVORowImpl row = (CmsExtendAttrStorageTVORowImpl)vo.createRow();
            row.setDocId(docId);
            row.setExtendAttrs(new ClobDomain(jsonStr));
            vo.insertRow(row);
        } else if ("EDIT".equals(actionName)) {
            vo.setbvDocId(docId);
            vo.executeQuery();
            CmsExtendAttrStorageTVORowImpl row = (CmsExtendAttrStorageTVORowImpl)vo.first();
            if (row != null) {
                row.setExtendAttrs(new ClobDomain(jsonStr));
            } else {
                row = (CmsExtendAttrStorageTVORowImpl)vo.createRow();
                row.setDocId(docId);
                row.setExtendAttrs(new ClobDomain(jsonStr));
                vo.insertRow(row);
            }
        } else if ("DELETE".equals(actionName)) {
            vo.setbvDocId(docId);
            vo.executeQuery();
            CmsExtendAttrStorageTVORowImpl row = (CmsExtendAttrStorageTVORowImpl)vo.first();
            if (row != null) {
                row.remove();
            }
        }
        this.getDBTransaction().commit();
    }

    /**
     * 获取自定义扩展字段的值
     * @param docId
     * @return
     */
    public String getExtendAttrs(Number docId) {
        CmsExtendAttrStorageTVOImpl vo = this.getCmsExtendAttrStorageTVO();
        vo.setbvDocId(docId);
        vo.executeQuery();
        CmsExtendAttrStorageTVORowImpl row = (CmsExtendAttrStorageTVORowImpl)vo.first();
        if (row != null) {
            return row.getExtendAttrs().toString();
        }
        return null;
    }

    public Map<String, String> getDocInfo(Number docId) {
        Map<String, String> map = new HashMap<String, String>();
        CmsDocTVOImpl vo = this.getCmsDocTVO4Query();
        vo.setbvDocId(docId);
        vo.executeQuery();
        CmsDocTVORowImpl row = (CmsDocTVORowImpl)vo.first();
        if (row != null) {
            map.put("compCode", row.getCompCode());
            map.put("libCode", row.getLibCode());
        }
        return map;
    }

    /**
     * Container's getter for CmsExtendAttrVO.
     * @return CmsExtendAttrVO
     */
    public CmsExtendAttrVOImpl getCmsExtendAttrVO() {
        return (CmsExtendAttrVOImpl)findViewObject("CmsExtendAttrVO");
    }

    /**
     * Container's getter for CmsExtendAttrVO4Choice.
     * @return CmsExtendAttrVO4Choice
     */
    public CmsExtendAttrVOImpl getCmsExtendAttrVO4Choice() {
        return (CmsExtendAttrVOImpl)findViewObject("CmsExtendAttrVO4Choice");
    }

    /**
     * Container's getter for CmsExtendValueList4Choice.
     * @return CmsExtendValueList4Choice
     */
    public CmsExtendValueListImpl getCmsExtendValueList4Choice() {
        return (CmsExtendValueListImpl)findViewObject("CmsExtendValueList4Choice");
    }

    /**
     * Container's getter for CmsExtendAttrStorageTVO.
     * @return CmsExtendAttrStorageTVO
     */
    public CmsExtendAttrStorageTVOImpl getCmsExtendAttrStorageTVO() {
        return (CmsExtendAttrStorageTVOImpl)findViewObject("CmsExtendAttrStorageTVO");
    }

    /**
     * Container's getter for CmsDocTVO4Query.
     * @return CmsDocTVO4Query
     */
    public CmsDocTVOImpl getCmsDocTVO4Query() {
        return (CmsDocTVOImpl)findViewObject("CmsDocTVO4Query");
    }

}
